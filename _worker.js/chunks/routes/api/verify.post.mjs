import{B as e,d as t,b as r,a as n,s as o,c as i,e as c}from"../../_/nitro.mjs";import{c as a,g as s}from"../../virtual/_commonjsHelpers.mjs";import"node:async_hooks";var p={exports:{}};var l,m={exports:{}},y={exports:{}},d={};function requireWeb(){if(l)return d;l=1,Object.defineProperty(d,"__esModule",{value:!0}),d.subtle=d.randomUUID=d.getRandomValues=void 0,d.subtle=globalThis.crypto?.subtle;d.randomUUID=()=>globalThis.crypto?.randomUUID();return d.getRandomValues=e=>globalThis.crypto?.getRandomValues(e),d}var f,u,h,g={},v={};function requireUtils(){if(f)return v;function createNotImplementedError(e){throw new Error(`[unenv] ${e} is not implemented yet!`)}return f=1,Object.defineProperty(v,"__esModule",{value:!0}),v.createNotImplementedError=createNotImplementedError,v.mergeFns=function(...e){return function(...t){for(const r of e)r(...t)}},v.notImplemented=function(e){return Object.assign((()=>{throw createNotImplementedError(e)}),{__unenv__:!0})},v.notImplementedClass=function(e){return class{__unenv__=!0;constructor(){throw new Error(`[unenv] ${e} is not implemented yet!`)}}},v.rawHeaders=function(e){const t=[];for(const r in e)if(Array.isArray(e[r]))for(const n of e[r])t.push(r,n);else t.push(r,e[r]);return t},v}function requireNode(){if(u)return g;u=1,Object.defineProperty(g,"__esModule",{value:!0}),g.webcrypto=g.verify=g.timingSafeEqual=g.sign=g.setFips=g.setEngine=g.secureHeapUsed=g.scryptSync=g.scrypt=g.randomInt=g.randomFillSync=g.randomFill=g.randomBytes=g.publicEncrypt=g.publicDecrypt=g.pseudoRandomBytes=g.privateEncrypt=g.privateDecrypt=g.pbkdf2Sync=g.pbkdf2=g.hkdfSync=g.hkdf=g.getHashes=g.getFips=g.getDiffieHellman=g.getCurves=g.getCiphers=g.getCipherInfo=g.generatePrimeSync=g.generatePrime=g.generateKeySync=g.generateKeyPairSync=g.generateKeyPair=g.generateKey=g.fips=g.diffieHellman=g.createVerify=g.createSign=g.createSecretKey=g.createPublicKey=g.createPrivateKey=g.createHmac=g.createHash=g.createECDH=g.createDiffieHellmanGroup=g.createDiffieHellman=g.createDecipheriv=g.createDecipher=g.createCipheriv=g.createCipher=g.constants=g.checkPrimeSync=g.checkPrime=g.X509Certificate=g.Verify=g.Sign=g.KeyObject=g.Hmac=g.Hash=g.ECDH=g.DiffieHellmanGroup=g.DiffieHellman=g.Decipheriv=g.Decipher=g.Cipheriv=g.Cipher=g.Certificate=void 0;var t=requireUtils(),r=requireWeb();g.webcrypto=new Proxy(globalThis.crypto,{get:(e,t)=>"CryptoKey"===t?globalThis.CryptoKey:"function"==typeof globalThis.crypto[t]?globalThis.crypto[t].bind(globalThis.crypto):globalThis.crypto[t]});return g.randomBytes=(t,n)=>{const o=e.alloc(t,0,void 0);for(let e=0;e<t;e+=65536)(0,r.getRandomValues)(Uint8Array.prototype.slice.call(o,e,e+65536));if("function"!=typeof n)return o;n(null,o)},g.fips=!1,g.constants={},g.checkPrime=(0,t.notImplemented)("crypto.checkPrime"),g.checkPrimeSync=(0,t.notImplemented)("crypto.checkPrimeSync"),g.createCipher=(0,t.notImplemented)("crypto.createCipher"),g.createDecipher=(0,t.notImplemented)("crypto.createDecipher"),g.pseudoRandomBytes=(0,t.notImplemented)("crypto.pseudoRandomBytes"),g.createCipheriv=(0,t.notImplemented)("crypto.createCipheriv"),g.createDecipheriv=(0,t.notImplemented)("crypto.createDecipheriv"),g.createDiffieHellman=(0,t.notImplemented)("crypto.createDiffieHellman"),g.createDiffieHellmanGroup=(0,t.notImplemented)("crypto.createDiffieHellmanGroup"),g.createECDH=(0,t.notImplemented)("crypto.createECDH"),g.createHash=(0,t.notImplemented)("crypto.createHash"),g.createHmac=(0,t.notImplemented)("crypto.createHmac"),g.createPrivateKey=(0,t.notImplemented)("crypto.createPrivateKey"),g.createPublicKey=(0,t.notImplemented)("crypto.createPublicKey"),g.createSecretKey=(0,t.notImplemented)("crypto.createSecretKey"),g.createSign=(0,t.notImplemented)("crypto.createSign"),g.createVerify=(0,t.notImplemented)("crypto.createVerify"),g.diffieHellman=(0,t.notImplemented)("crypto.diffieHellman"),g.generatePrime=(0,t.notImplemented)("crypto.generatePrime"),g.generatePrimeSync=(0,t.notImplemented)("crypto.generatePrimeSync"),g.getCiphers=(0,t.notImplemented)("crypto.getCiphers"),g.getCipherInfo=(0,t.notImplemented)("crypto.getCipherInfo"),g.getCurves=(0,t.notImplemented)("crypto.getCurves"),g.getDiffieHellman=(0,t.notImplemented)("crypto.getDiffieHellman"),g.getHashes=(0,t.notImplemented)("crypto.getHashes"),g.hkdf=(0,t.notImplemented)("crypto.hkdf"),g.hkdfSync=(0,t.notImplemented)("crypto.hkdfSync"),g.pbkdf2=(0,t.notImplemented)("crypto.pbkdf2"),g.pbkdf2Sync=(0,t.notImplemented)("crypto.pbkdf2Sync"),g.generateKeyPair=(0,t.notImplemented)("crypto.generateKeyPair"),g.generateKeyPairSync=(0,t.notImplemented)("crypto.generateKeyPairSync"),g.generateKey=(0,t.notImplemented)("crypto.generateKey"),g.generateKeySync=(0,t.notImplemented)("crypto.generateKeySync"),g.privateDecrypt=(0,t.notImplemented)("crypto.privateDecrypt"),g.privateEncrypt=(0,t.notImplemented)("crypto.privateEncrypt"),g.publicDecrypt=(0,t.notImplemented)("crypto.publicDecrypt"),g.publicEncrypt=(0,t.notImplemented)("crypto.publicEncrypt"),g.randomFill=(0,t.notImplemented)("crypto.randomFill"),g.randomFillSync=(0,t.notImplemented)("crypto.randomFillSync"),g.randomInt=(0,t.notImplemented)("crypto.randomInt"),g.scrypt=(0,t.notImplemented)("crypto.scrypt"),g.scryptSync=(0,t.notImplemented)("crypto.scryptSync"),g.sign=(0,t.notImplemented)("crypto.sign"),g.setEngine=(0,t.notImplemented)("crypto.setEngine"),g.timingSafeEqual=(0,t.notImplemented)("crypto.timingSafeEqual"),g.getFips=(0,t.notImplemented)("crypto.getFips"),g.setFips=(0,t.notImplemented)("crypto.setFips"),g.verify=(0,t.notImplemented)("crypto.verify"),g.secureHeapUsed=(0,t.notImplemented)("crypto.secureHeapUsed"),g.Certificate=(0,t.notImplementedClass)("crypto.Certificate"),g.Cipher=(0,t.notImplementedClass)("crypto.Cipher"),g.Cipheriv=(0,t.notImplementedClass)("crypto.Cipheriv"),g.Decipher=(0,t.notImplementedClass)("crypto.Decipher"),g.Decipheriv=(0,t.notImplementedClass)("crypto.Decipheriv"),g.DiffieHellman=(0,t.notImplementedClass)("crypto.DiffieHellman"),g.DiffieHellmanGroup=(0,t.notImplementedClass)("crypto.DiffieHellmanGroup"),g.ECDH=(0,t.notImplementedClass)("crypto.ECDH"),g.Hash=(0,t.notImplementedClass)("crypto.Hash"),g.Hmac=(0,t.notImplementedClass)("crypto.Hmac"),g.KeyObject=(0,t.notImplementedClass)("crypto.KeyObject"),g.Sign=(0,t.notImplementedClass)("crypto.Sign"),g.Verify=(0,t.notImplementedClass)("crypto.Verify"),g.X509Certificate=(0,t.notImplementedClass)("crypto.X509Certificate"),g}function requireCrypto(){return h||(h=1,function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={},n=_interopRequireWildcard(requireWeb());Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))}));var o=_interopRequireWildcard(requireNode());function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(_getRequireWildcardCache=function(e){return e?r:t})(e)}function _interopRequireWildcard(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&{}.hasOwnProperty.call(e,i)){var c=o?Object.getOwnPropertyDescriptor(e,i):null;c&&(c.get||c.set)?Object.defineProperty(n,i,c):n[i]=e[i]}return n.default=e,r&&r.set(e,n),n}Object.keys(o).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(r,e)||e in t&&t[e]===o[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}}))})),e.exports={...n,...o}}(y,y.exports)),y.exports}var I;function requireCore(){return I||(I=1,m.exports=(e=e||function(e,t){var r;if("undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&void 0!==a&&a.crypto&&(r=a.crypto),!r)try{r=requireCrypto()}catch(e){}var cryptoSecureRandomInt=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function F(){}return function(e){var t;return F.prototype=e,t=new F,F.prototype=null,t}}(),o={},i=o.lib={},c=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=i.WordArray=c.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var c=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=c<<24-(n+i)%4*8}else for(var a=0;a<o;a+=4)t[n+a>>>2]=r[a>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(cryptoSecureRandomInt());return new s.init(t,e)}}),p=o.enc={},l=p.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new s.init(r,t/2)}},m=p.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new s.init(r,t)}},y=p.Utf8={stringify:function(e){try{return decodeURIComponent(escape(m.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return m.parse(unescape(encodeURIComponent(e)))}},d=i.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=y.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,o=n.words,i=n.sigBytes,c=this.blockSize,a=i/(4*c),p=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*c,l=e.min(4*p,i);if(p){for(var m=0;m<p;m+=c)this._doProcessBlock(o,m);r=o.splice(0,p),n.sigBytes-=l}return new s.init(r,l)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});i.Hasher=d.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}});var f=o.algo={};return o}(Math),e)),m.exports;var e}var _;p.exports=(_=requireCore(),function(e){var t=_,r=t.lib,n=r.WordArray,o=r.Hasher,i=t.algo,c=[],a=[];!function(){function isPrime(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function getFractionalBits(e){return 4294967296*(e-(0|e))|0}for(var t=2,r=0;r<64;)isPrime(t)&&(r<8&&(c[r]=getFractionalBits(e.pow(t,.5))),a[r]=getFractionalBits(e.pow(t,1/3)),r++),t++}();var s=[],p=i.SHA256=o.extend({_doReset:function(){this._hash=new n.init(c.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],i=r[2],c=r[3],p=r[4],l=r[5],m=r[6],y=r[7],d=0;d<64;d++){if(d<16)s[d]=0|e[t+d];else{var f=s[d-15],u=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,h=s[d-2],g=(h<<15|h>>>17)^(h<<13|h>>>19)^h>>>10;s[d]=u+s[d-7]+g+s[d-16]}var v=n&o^n&i^o&i,I=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),_=y+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&l^~p&m)+a[d]+s[d];y=m,m=l,l=p,p=c+_|0,c=i,i=o,o=n,n=_+(I+v)|0}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+i|0,r[3]=r[3]+c|0,r[4]=r[4]+p|0,r[5]=r[5]+l|0,r[6]=r[6]+m|0,r[7]=r[7]+y|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,o=8*t.sigBytes;return r[o>>>5]|=128<<24-o%32,r[14+(o+64>>>9<<4)]=e.floor(n/4294967296),r[15+(o+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(p),t.HmacSHA256=o._createHmacHelper(p)}(Math),_.SHA256);const b=s(p.exports),C=t((async e=>{try{const t=await r(e),a=n(),{sitePassword:s}=a;if(!s)throw new Error("Site password not configured");if(!(null==t?void 0:t.password)||0===(null==t?void 0:t.password.length))throw new Error("Password is required");const p=b(s).toString();if((null==t?void 0:t.password)!==p)return o(e,401),{code:401,message:"password is incorrect"};const l=await i("30d");return c(e,"authToken",l,{httpOnly:!0,maxAge:2592e3,sameSite:"strict"}),{code:200,message:"password is correct",token:l}}catch(t){return console.error("Password validation error:",t),o(e,500),{code:500,message:t instanceof Error?t.message:"Unknown error"}}}));export{C as default};
//# sourceMappingURL=verify.post.mjs.map
