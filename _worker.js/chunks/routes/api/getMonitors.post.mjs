import{p as e,a as s,d as i,g as n,v as r,s as o}from"../../_/nitro.mjs";import{g as a}from"../../virtual/_commonjsHelpers.mjs";import"node:async_hooks";var c={exports:{}};const u=a(c.exports=function(){var e=1e3,s=6e4,i=36e5,n="millisecond",r="second",o="minute",a="hour",c="day",u="week",f="month",p="quarter",g="year",v="date",w="Invalid Date",_=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,z=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,k={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var s=["th","st","nd","rd"],i=e%100;return"["+e+(s[(i-20)%10]||s[i]||s[0])+"]"}},m=function(e,s,i){var n=String(e);return!n||n.length>=s?e:""+Array(s+1-n.length).join(i)+e},L={s:m,z:function(e){var s=-e.utcOffset(),i=Math.abs(s),n=Math.floor(i/60),r=i%60;return(s<=0?"+":"-")+m(n,2,"0")+":"+m(r,2,"0")},m:function t(e,s){if(e.date()<s.date())return-t(s,e);var i=12*(s.year()-e.year())+(s.month()-e.month()),n=e.clone().add(i,f),r=s-n<0,o=e.clone().add(i+(r?-1:1),f);return+(-(i+(s-n)/(r?n-o:o-n))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:f,y:g,w:u,d:c,D:v,h:a,m:o,s:r,ms:n,Q:p}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},x="en",A={};A[x]=k;var T="$isDayjsObject",S=function(e){return e instanceof E||!(!e||!e[T])},b=function t(e,s,i){var n;if(!e)return x;if("string"==typeof e){var r=e.toLowerCase();A[r]&&(n=r),s&&(A[r]=s,n=r);var o=e.split("-");if(!n&&o.length>1)return t(o[0])}else{var a=e.name;A[a]=e,n=a}return!i&&n&&(x=n),n||!i&&x},O=function(e,s){if(S(e))return e.clone();var i="object"==typeof s?s:{};return i.date=e,i.args=arguments,new E(i)},F=L;F.l=b,F.i=S,F.w=function(e,s){return O(e,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var E=function(){function M(e){this.$L=b(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[T]=!0}var k=M.prototype;return k.parse=function(e){this.$d=function(e){var s=e.date,i=e.utc;if(null===s)return new Date(NaN);if(F.u(s))return new Date;if(s instanceof Date)return new Date(s);if("string"==typeof s&&!/Z$/i.test(s)){var n=s.match(_);if(n){var r=n[2]-1||0,o=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)}}return new Date(s)}(e),this.init()},k.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},k.$utils=function(){return F},k.isValid=function(){return!(this.$d.toString()===w)},k.isSame=function(e,s){var i=O(e);return this.startOf(s)<=i&&i<=this.endOf(s)},k.isAfter=function(e,s){return O(e)<this.startOf(s)},k.isBefore=function(e,s){return this.endOf(s)<O(e)},k.$g=function(e,s,i){return F.u(e)?this[s]:this.set(i,e)},k.unix=function(){return Math.floor(this.valueOf()/1e3)},k.valueOf=function(){return this.$d.getTime()},k.startOf=function(e,s){var i=this,n=!!F.u(s)||s,p=F.p(e),l=function(e,s){var r=F.w(i.$u?Date.UTC(i.$y,s,e):new Date(i.$y,s,e),i);return n?r:r.endOf(c)},$=function(e,s){return F.w(i.toDate()[e].apply(i.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(s)),i)},w=this.$W,_=this.$M,z=this.$D,k="set"+(this.$u?"UTC":"");switch(p){case g:return n?l(1,0):l(31,11);case f:return n?l(1,_):l(0,_+1);case u:var L=this.$locale().weekStart||0,x=(w<L?w+7:w)-L;return l(n?z-x:z+(6-x),_);case c:case v:return $(k+"Hours",0);case a:return $(k+"Minutes",1);case o:return $(k+"Seconds",2);case r:return $(k+"Milliseconds",3);default:return this.clone()}},k.endOf=function(e){return this.startOf(e,!1)},k.$set=function(e,s){var i,u=F.p(e),p="set"+(this.$u?"UTC":""),w=(i={},i[c]=p+"Date",i[v]=p+"Date",i[f]=p+"Month",i[g]=p+"FullYear",i[a]=p+"Hours",i[o]=p+"Minutes",i[r]=p+"Seconds",i[n]=p+"Milliseconds",i)[u],_=u===c?this.$D+(s-this.$W):s;if(u===f||u===g){var z=this.clone().set(v,1);z.$d[w](_),z.init(),this.$d=z.set(v,Math.min(this.$D,z.daysInMonth())).$d}else w&&this.$d[w](_);return this.init(),this},k.set=function(e,s){return this.clone().$set(e,s)},k.get=function(e){return this[F.p(e)]()},k.add=function(n,p){var v,w=this;n=Number(n);var _=F.p(p),y=function(e){var s=O(w);return F.w(s.date(s.date()+Math.round(e*n)),w)};if(_===f)return this.set(f,this.$M+n);if(_===g)return this.set(g,this.$y+n);if(_===c)return y(1);if(_===u)return y(7);var z=(v={},v[o]=s,v[a]=i,v[r]=e,v)[_]||1,k=this.$d.getTime()+n*z;return F.w(k,this)},k.subtract=function(e,s){return this.add(-1*e,s)},k.format=function(e){var s=this,i=this.$locale();if(!this.isValid())return i.invalidDate||w;var n=e||"YYYY-MM-DDTHH:mm:ssZ",r=F.z(this),o=this.$H,a=this.$m,c=this.$M,u=i.weekdays,f=i.months,p=i.meridiem,h=function(e,i,r,o){return e&&(e[i]||e(s,n))||r[i].slice(0,o)},d=function(e){return F.s(o%12||12,e,"0")},g=p||function(e,s,i){var n=e<12?"AM":"PM";return i?n.toLowerCase():n};return n.replace(z,(function(e,n){return n||function(e){switch(e){case"YY":return String(s.$y).slice(-2);case"YYYY":return F.s(s.$y,4,"0");case"M":return c+1;case"MM":return F.s(c+1,2,"0");case"MMM":return h(i.monthsShort,c,f,3);case"MMMM":return h(f,c);case"D":return s.$D;case"DD":return F.s(s.$D,2,"0");case"d":return String(s.$W);case"dd":return h(i.weekdaysMin,s.$W,u,2);case"ddd":return h(i.weekdaysShort,s.$W,u,3);case"dddd":return u[s.$W];case"H":return String(o);case"HH":return F.s(o,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return g(o,a,!0);case"A":return g(o,a,!1);case"m":return String(a);case"mm":return F.s(a,2,"0");case"s":return String(s.$s);case"ss":return F.s(s.$s,2,"0");case"SSS":return F.s(s.$ms,3,"0");case"Z":return r}return null}(e)||r.replace(":","")}))},k.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},k.diff=function(n,v,w){var _,z=this,k=F.p(v),L=O(n),x=(L.utcOffset()-this.utcOffset())*s,A=this-L,D=function(){return F.m(z,L)};switch(k){case g:_=D()/12;break;case f:_=D();break;case p:_=D()/3;break;case u:_=(A-x)/6048e5;break;case c:_=(A-x)/864e5;break;case a:_=A/i;break;case o:_=A/s;break;case r:_=A/e;break;default:_=A}return w?_:F.a(_)},k.daysInMonth=function(){return this.endOf(f).$D},k.$locale=function(){return A[this.$L]},k.locale=function(e,s){if(!e)return this.$L;var i=this.clone(),n=b(e,s,!0);return n&&(i.$L=n),i},k.clone=function(){return F.w(this.$d,this)},k.toDate=function(){return new Date(this.valueOf())},k.toJSON=function(){return this.isValid()?this.toISOString():null},k.toISOString=function(){return this.$d.toISOString()},k.toString=function(){return this.$d.toUTCString()},M}(),C=E.prototype;return O.prototype=C,[["$ms",n],["$s",r],["$m",o],["$H",a],["$W",c],["$M",f],["$y",g],["$D",v]].forEach((function(e){C[e[1]]=function(s){return this.$g(s,e[0],e[1])}})),O.extend=function(e,s){return e.$i||(e(s,E,O),e.$i=!0),O},O.locale=b,O.isDayjs=S,O.unix=function(e){return O(1e3*e)},O.en=A[x],O.Ls=A,O.p={},O}()),f="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,p=new Set,g="object"==typeof e&&e?e:{},emitWarning=(e,s,i,n)=>{"function"==typeof g.emitWarning?g.emitWarning(e,s,i,n):console.error(`[${i}] ${s}: ${e}`)};let v=globalThis.AbortController,w=globalThis.AbortSignal;if(void 0===v){w=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,s){this._onabort.push(s)}},v=class{constructor(){warnACPolyfill()}signal=new w;abort(e){if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(const s of this.signal._onabort)s(e);this.signal.onabort?.(e)}}};let e="1"!==g.env?.LRU_CACHE_IGNORE_AC_WARNING;const warnACPolyfill=()=>{e&&(e=!1,emitWarning("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",warnACPolyfill))}}const isPosInt=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),getUintArray=e=>isPosInt(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?ZeroArray:null:null;class ZeroArray extends Array{constructor(e){super(e),this.fill(0)}}class Stack{heap;length;static#t=!1;static create(e){const s=getUintArray(e);if(!s)return[];Stack.#t=!0;const i=new Stack(e,s);return Stack.#t=!1,i}constructor(e,s){if(!Stack.#t)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new s(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class LRUCache{#e;#s;#i;#n;#r;#o;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#a;#h;#l;#c;#u;#d;#f;#p;#g;#v;#m;#S;#y;#w;#_;#z;#k;static unsafeExposeInternals(e){return{starts:e.#y,ttls:e.#w,sizes:e.#S,keyMap:e.#l,keyList:e.#c,valList:e.#u,next:e.#d,prev:e.#f,get head(){return e.#p},get tail(){return e.#g},free:e.#v,isBackgroundFetch:s=>e.#L(s),backgroundFetch:(s,i,n,r)=>e.#x(s,i,n,r),moveToTail:s=>e.#A(s),indexes:s=>e.#T(s),rindexes:s=>e.#b(s),isStale:s=>e.#M(s)}}get max(){return this.#e}get maxSize(){return this.#s}get calculatedSize(){return this.#h}get size(){return this.#a}get fetchMethod(){return this.#r}get memoMethod(){return this.#o}get dispose(){return this.#i}get disposeAfter(){return this.#n}constructor(e){const{max:s=0,ttl:i,ttlResolution:n=1,ttlAutopurge:r,updateAgeOnGet:o,updateAgeOnHas:a,allowStale:c,dispose:u,disposeAfter:f,noDisposeOnSet:g,noUpdateTTL:v,maxSize:w=0,maxEntrySize:_=0,sizeCalculation:z,fetchMethod:k,memoMethod:L,noDeleteOnFetchRejection:x,noDeleteOnStaleGet:A,allowStaleOnFetchRejection:T,allowStaleOnFetchAbort:b,ignoreFetchAbort:F}=e;if(0!==s&&!isPosInt(s))throw new TypeError("max option must be a nonnegative integer");const E=s?getUintArray(s):Array;if(!E)throw new Error("invalid max value: "+s);if(this.#e=s,this.#s=w,this.maxEntrySize=_||this.#s,this.sizeCalculation=z,this.sizeCalculation){if(!this.#s&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==L&&"function"!=typeof L)throw new TypeError("memoMethod must be a function if defined");if(this.#o=L,void 0!==k&&"function"!=typeof k)throw new TypeError("fetchMethod must be a function if specified");if(this.#r=k,this.#z=!!k,this.#l=new Map,this.#c=new Array(s).fill(void 0),this.#u=new Array(s).fill(void 0),this.#d=new E(s),this.#f=new E(s),this.#p=0,this.#g=0,this.#v=Stack.create(s),this.#a=0,this.#h=0,"function"==typeof u&&(this.#i=u),"function"==typeof f?(this.#n=f,this.#m=[]):(this.#n=void 0,this.#m=void 0),this.#_=!!this.#i,this.#k=!!this.#n,this.noDisposeOnSet=!!g,this.noUpdateTTL=!!v,this.noDeleteOnFetchRejection=!!x,this.allowStaleOnFetchRejection=!!T,this.allowStaleOnFetchAbort=!!b,this.ignoreFetchAbort=!!F,0!==this.maxEntrySize){if(0!==this.#s&&!isPosInt(this.#s))throw new TypeError("maxSize must be a positive integer if specified");if(!isPosInt(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#F()}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!A,this.updateAgeOnGet=!!o,this.updateAgeOnHas=!!a,this.ttlResolution=isPosInt(n)||0===n?n:1,this.ttlAutopurge=!!r,this.ttl=i||0,this.ttl){if(!isPosInt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#D()}if(0===this.#e&&0===this.ttl&&0===this.#s)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#s){const e="LRU_CACHE_UNBOUNDED";if((e=>!p.has(e))(e)){p.add(e);emitWarning("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,LRUCache)}}}getRemainingTTL(e){return this.#l.has(e)?1/0:0}#D(){const e=new ZeroArray(this.#e),s=new ZeroArray(this.#e);this.#w=e,this.#y=s,this.#$=(i,n,r=f.now())=>{if(s[i]=0!==n?r:0,e[i]=n,0!==n&&this.ttlAutopurge){const e=setTimeout((()=>{this.#M(i)&&this.#O(this.#c[i],"expire")}),n+1);e.unref&&e.unref()}},this.#E=i=>{s[i]=0!==e[i]?f.now():0},this.#C=(n,r)=>{if(e[r]){const o=e[r],a=s[r];if(!o||!a)return;n.ttl=o,n.start=a,n.now=i||getNow();const c=n.now-a;n.remainingTTL=o-c}};let i=0;const getNow=()=>{const e=f.now();if(this.ttlResolution>0){i=e;const s=setTimeout((()=>i=0),this.ttlResolution);s.unref&&s.unref()}return e};this.getRemainingTTL=n=>{const r=this.#l.get(n);if(void 0===r)return 0;const o=e[r],a=s[r];if(!o||!a)return 1/0;return o-((i||getNow())-a)},this.#M=n=>{const r=s[n],o=e[n];return!!o&&!!r&&(i||getNow())-r>o}}#E=()=>{};#C=()=>{};#$=()=>{};#M=()=>!1;#F(){const e=new ZeroArray(this.#e);this.#h=0,this.#S=e,this.#R=s=>{this.#h-=e[s],e[s]=0},this.#W=(e,s,i,n)=>{if(this.#L(s))return 0;if(!isPosInt(i)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof n)throw new TypeError("sizeCalculation must be a function");if(i=n(s,e),!isPosInt(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return i},this.#I=(s,i,n)=>{if(e[s]=i,this.#s){const i=this.#s-e[s];for(;this.#h>i;)this.#U(!0)}this.#h+=e[s],n&&(n.entrySize=i,n.totalCalculatedSize=this.#h)}}#R=e=>{};#I=(e,s,i)=>{};#W=(e,s,i,n)=>{if(i||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#T({allowStale:e=this.allowStale}={}){if(this.#a)for(let s=this.#g;this.#B(s)&&(!e&&this.#M(s)||(yield s),s!==this.#p);)s=this.#f[s]}*#b({allowStale:e=this.allowStale}={}){if(this.#a)for(let s=this.#p;this.#B(s)&&(!e&&this.#M(s)||(yield s),s!==this.#g);)s=this.#d[s]}#B(e){return void 0!==e&&this.#l.get(this.#c[e])===e}*entries(){for(const e of this.#T())void 0===this.#u[e]||void 0===this.#c[e]||this.#L(this.#u[e])||(yield[this.#c[e],this.#u[e]])}*rentries(){for(const e of this.#b())void 0===this.#u[e]||void 0===this.#c[e]||this.#L(this.#u[e])||(yield[this.#c[e],this.#u[e]])}*keys(){for(const e of this.#T()){const s=this.#c[e];void 0===s||this.#L(this.#u[e])||(yield s)}}*rkeys(){for(const e of this.#b()){const s=this.#c[e];void 0===s||this.#L(this.#u[e])||(yield s)}}*values(){for(const e of this.#T()){void 0===this.#u[e]||this.#L(this.#u[e])||(yield this.#u[e])}}*rvalues(){for(const e of this.#b()){void 0===this.#u[e]||this.#L(this.#u[e])||(yield this.#u[e])}}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,s={}){for(const i of this.#T()){const n=this.#u[i],r=this.#L(n)?n.__staleWhileFetching:n;if(void 0!==r&&e(r,this.#c[i],this))return this.get(this.#c[i],s)}}forEach(e,s=this){for(const i of this.#T()){const n=this.#u[i],r=this.#L(n)?n.__staleWhileFetching:n;void 0!==r&&e.call(s,r,this.#c[i],this)}}rforEach(e,s=this){for(const i of this.#b()){const n=this.#u[i],r=this.#L(n)?n.__staleWhileFetching:n;void 0!==r&&e.call(s,r,this.#c[i],this)}}purgeStale(){let e=!1;for(const s of this.#b({allowStale:!0}))this.#M(s)&&(this.#O(this.#c[s],"expire"),e=!0);return e}info(e){const s=this.#l.get(e);if(void 0===s)return;const i=this.#u[s],n=this.#L(i)?i.__staleWhileFetching:i;if(void 0===n)return;const r={value:n};if(this.#w&&this.#y){const e=this.#w[s],i=this.#y[s];if(e&&i){const s=e-(f.now()-i);r.ttl=s,r.start=Date.now()}}return this.#S&&(r.size=this.#S[s]),r}dump(){const e=[];for(const s of this.#T({allowStale:!0})){const i=this.#c[s],n=this.#u[s],r=this.#L(n)?n.__staleWhileFetching:n;if(void 0===r||void 0===i)continue;const o={value:r};if(this.#w&&this.#y){o.ttl=this.#w[s];const e=f.now()-this.#y[s];o.start=Math.floor(Date.now()-e)}this.#S&&(o.size=this.#S[s]),e.unshift([i,o])}return e}load(e){this.clear();for(const[s,i]of e){if(i.start){const e=Date.now()-i.start;i.start=f.now()-e}this.set(s,i.value,i)}}set(e,s,i={}){if(void 0===s)return this.delete(e),this;const{ttl:n=this.ttl,start:r,noDisposeOnSet:o=this.noDisposeOnSet,sizeCalculation:a=this.sizeCalculation,status:c}=i;let{noUpdateTTL:u=this.noUpdateTTL}=i;const f=this.#W(e,s,i.size||0,a);if(this.maxEntrySize&&f>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),this.#O(e,"set"),this;let p=0===this.#a?void 0:this.#l.get(e);if(void 0===p)p=0===this.#a?this.#g:0!==this.#v.length?this.#v.pop():this.#a===this.#e?this.#U(!1):this.#a,this.#c[p]=e,this.#u[p]=s,this.#l.set(e,p),this.#d[this.#g]=p,this.#f[p]=this.#g,this.#g=p,this.#a++,this.#I(p,f,c),c&&(c.set="add"),u=!1;else{this.#A(p);const i=this.#u[p];if(s!==i){if(this.#z&&this.#L(i)){i.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:s}=i;void 0===s||o||(this.#_&&this.#i?.(s,e,"set"),this.#k&&this.#m?.push([s,e,"set"]))}else o||(this.#_&&this.#i?.(i,e,"set"),this.#k&&this.#m?.push([i,e,"set"]));if(this.#R(p),this.#I(p,f,c),this.#u[p]=s,c){c.set="replace";const e=i&&this.#L(i)?i.__staleWhileFetching:i;void 0!==e&&(c.oldValue=e)}}else c&&(c.set="update")}if(0===n||this.#w||this.#D(),this.#w&&(u||this.#$(p,n,r),c&&this.#C(c,p)),!o&&this.#k&&this.#m){const e=this.#m;let s;for(;s=e?.shift();)this.#n?.(...s)}return this}pop(){try{for(;this.#a;){const e=this.#u[this.#p];if(this.#U(!0),this.#L(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#k&&this.#m){const e=this.#m;let s;for(;s=e?.shift();)this.#n?.(...s)}}}#U(e){const s=this.#p,i=this.#c[s],n=this.#u[s];return this.#z&&this.#L(n)?n.__abortController.abort(new Error("evicted")):(this.#_||this.#k)&&(this.#_&&this.#i?.(n,i,"evict"),this.#k&&this.#m?.push([n,i,"evict"])),this.#R(s),e&&(this.#c[s]=void 0,this.#u[s]=void 0,this.#v.push(s)),1===this.#a?(this.#p=this.#g=0,this.#v.length=0):this.#p=this.#d[s],this.#l.delete(i),this.#a--,s}has(e,s={}){const{updateAgeOnHas:i=this.updateAgeOnHas,status:n}=s,r=this.#l.get(e);if(void 0!==r){const e=this.#u[r];if(this.#L(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#M(r))return i&&this.#E(r),n&&(n.has="hit",this.#C(n,r)),!0;n&&(n.has="stale",this.#C(n,r))}else n&&(n.has="miss");return!1}peek(e,s={}){const{allowStale:i=this.allowStale}=s,n=this.#l.get(e);if(void 0===n||!i&&this.#M(n))return;const r=this.#u[n];return this.#L(r)?r.__staleWhileFetching:r}#x(e,s,i,n){const r=void 0===s?void 0:this.#u[s];if(this.#L(r))return r;const o=new v,{signal:a}=i;a?.addEventListener("abort",(()=>o.abort(a.reason)),{signal:o.signal});const c={signal:o.signal,options:i,context:n},cb=(n,r=!1)=>{const{aborted:a}=o.signal,f=i.ignoreFetchAbort&&void 0!==n;if(i.status&&(a&&!r?(i.status.fetchAborted=!0,i.status.fetchError=o.signal.reason,f&&(i.status.fetchAbortIgnored=!0)):i.status.fetchResolved=!0),a&&!f&&!r)return fetchFail(o.signal.reason);const p=u;return this.#u[s]===u&&(void 0===n?p.__staleWhileFetching?this.#u[s]=p.__staleWhileFetching:this.#O(e,"fetch"):(i.status&&(i.status.fetchUpdated=!0),this.set(e,n,c.options))),n},fetchFail=n=>{const{aborted:r}=o.signal,a=r&&i.allowStaleOnFetchAbort,c=a||i.allowStaleOnFetchRejection,f=c||i.noDeleteOnFetchRejection,p=u;if(this.#u[s]===u){!f||void 0===p.__staleWhileFetching?this.#O(e,"fetch"):a||(this.#u[s]=p.__staleWhileFetching)}if(c)return i.status&&void 0!==p.__staleWhileFetching&&(i.status.returnedStale=!0),p.__staleWhileFetching;if(p.__returned===p)throw n};i.status&&(i.status.fetchDispatched=!0);const u=new Promise(((s,n)=>{const a=this.#r?.(e,r,c);a&&a instanceof Promise&&a.then((e=>s(void 0===e?void 0:e)),n),o.signal.addEventListener("abort",(()=>{i.ignoreFetchAbort&&!i.allowStaleOnFetchAbort||(s(void 0),i.allowStaleOnFetchAbort&&(s=e=>cb(e,!0)))}))})).then(cb,(e=>(i.status&&(i.status.fetchRejected=!0,i.status.fetchError=e),fetchFail(e)))),f=Object.assign(u,{__abortController:o,__staleWhileFetching:r,__returned:void 0});return void 0===s?(this.set(e,f,{...c.options,status:void 0}),s=this.#l.get(e)):this.#u[s]=f,f}#L(e){if(!this.#z)return!1;const s=e;return!!s&&s instanceof Promise&&s.hasOwnProperty("__staleWhileFetching")&&s.__abortController instanceof v}async fetch(e,s={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,ttl:o=this.ttl,noDisposeOnSet:a=this.noDisposeOnSet,size:c=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:f=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:g=this.allowStaleOnFetchRejection,ignoreFetchAbort:v=this.ignoreFetchAbort,allowStaleOnFetchAbort:w=this.allowStaleOnFetchAbort,context:_,forceRefresh:z=!1,status:k,signal:L}=s;if(!this.#z)return k&&(k.fetch="get"),this.get(e,{allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,status:k});const x={allowStale:i,updateAgeOnGet:n,noDeleteOnStaleGet:r,ttl:o,noDisposeOnSet:a,size:c,sizeCalculation:u,noUpdateTTL:f,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:g,allowStaleOnFetchAbort:w,ignoreFetchAbort:v,status:k,signal:L};let A=this.#l.get(e);if(void 0===A){k&&(k.fetch="miss");const s=this.#x(e,A,x,_);return s.__returned=s}{const s=this.#u[A];if(this.#L(s)){const e=i&&void 0!==s.__staleWhileFetching;return k&&(k.fetch="inflight",e&&(k.returnedStale=!0)),e?s.__staleWhileFetching:s.__returned=s}const r=this.#M(A);if(!z&&!r)return k&&(k.fetch="hit"),this.#A(A),n&&this.#E(A),k&&this.#C(k,A),s;const o=this.#x(e,A,x,_),a=void 0!==o.__staleWhileFetching&&i;return k&&(k.fetch=r?"stale":"refresh",a&&r&&(k.returnedStale=!0)),a?o.__staleWhileFetching:o.__returned=o}}async forceFetch(e,s={}){const i=await this.fetch(e,s);if(void 0===i)throw new Error("fetch() returned undefined");return i}memo(e,s={}){const i=this.#o;if(!i)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:r,...o}=s,a=this.get(e,o);if(!r&&void 0!==a)return a;const c=i(e,a,{options:o,context:n});return this.set(e,c,o),c}get(e,s={}){const{allowStale:i=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:r=this.noDeleteOnStaleGet,status:o}=s,a=this.#l.get(e);if(void 0!==a){const s=this.#u[a],c=this.#L(s);return o&&this.#C(o,a),this.#M(a)?(o&&(o.get="stale"),c?(o&&i&&void 0!==s.__staleWhileFetching&&(o.returnedStale=!0),i?s.__staleWhileFetching:void 0):(r||this.#O(e,"expire"),o&&i&&(o.returnedStale=!0),i?s:void 0)):(o&&(o.get="hit"),c?s.__staleWhileFetching:(this.#A(a),n&&this.#E(a),s))}o&&(o.get="miss")}#j(e,s){this.#f[s]=e,this.#d[e]=s}#A(e){e!==this.#g&&(e===this.#p?this.#p=this.#d[e]:this.#j(this.#f[e],this.#d[e]),this.#j(this.#g,e),this.#g=e)}delete(e){return this.#O(e,"delete")}#O(e,s){let i=!1;if(0!==this.#a){const n=this.#l.get(e);if(void 0!==n)if(i=!0,1===this.#a)this.#G(s);else{this.#R(n);const i=this.#u[n];if(this.#L(i)?i.__abortController.abort(new Error("deleted")):(this.#_||this.#k)&&(this.#_&&this.#i?.(i,e,s),this.#k&&this.#m?.push([i,e,s])),this.#l.delete(e),this.#c[n]=void 0,this.#u[n]=void 0,n===this.#g)this.#g=this.#f[n];else if(n===this.#p)this.#p=this.#d[n];else{const e=this.#f[n];this.#d[e]=this.#d[n];const s=this.#d[n];this.#f[s]=this.#f[n]}this.#a--,this.#v.push(n)}}if(this.#k&&this.#m?.length){const e=this.#m;let s;for(;s=e?.shift();)this.#n?.(...s)}return i}clear(){return this.#G("delete")}#G(e){for(const s of this.#b({allowStale:!0})){const i=this.#u[s];if(this.#L(i))i.__abortController.abort(new Error("deleted"));else{const n=this.#c[s];this.#_&&this.#i?.(i,n,e),this.#k&&this.#m?.push([i,n,e])}}if(this.#l.clear(),this.#u.fill(void 0),this.#c.fill(void 0),this.#w&&this.#y&&(this.#w.fill(0),this.#y.fill(0)),this.#S&&this.#S.fill(0),this.#p=0,this.#g=0,this.#v.length=0,this.#h=0,this.#a=0,this.#k&&this.#m){const e=this.#m;let s;for(;s=e?.shift();)this.#n?.(...s)}}}const _=new LRUCache({max:100,ttl:3e5}),formatNumber=e=>Math.floor(100*e)/100,z=i((async e=>{try{const o=s(),{apiUrl:a,apiKey:c,sitePassword:f,siteSecretKey:p}=o;if(!a||!c)throw new Error("Missing API url or API key");if(f&&p){const s=n(e,"authToken");if(!s)throw new Error("Please log in first");if(!await r(s))throw new Error("Invalid or expired token")}const g="site-data",v=(i=g,_.get(i));if(v)return{code:200,message:"success",source:"cache",data:v};const w=(()=>{try{const e=[],i=s().public.countDays,n=u((new Date).setHours(0,0,0,0));for(let s=0;s<i;s++)e.push(n.subtract(s,"day"));const r=e.map((e=>`${e.unix()}_${e.add(1,"day").unix()}`)),o=e[e.length-1].unix(),a=e[0].add(1,"day").unix();return r.push(`${o}_${a}`),{dates:e,start:o,end:a,ranges:r.join("-")}}catch(e){return void console.error(e)}})();if(!w)throw new Error("Missing");const{dates:z,ranges:k,start:L,end:x}=w,A={api_key:c,format:"json",logs:1,log_types:"1-2",logs_start_date:L,logs_end_date:x,custom_uptime_ranges:k},T=((e,i)=>{if(!(null==e?void 0:e.monitors))return;const{public:n}=s(),{showLink:r}=n,o=e.monitors,a=null==o?void 0:o.map((e=>{var s,n,o,a;const c=e.custom_uptime_ranges.split("-"),f=formatNumber(c.pop()||0),p=[],g=new Map;i.forEach(((e,s)=>{g.set(e.format("YYYYMMDD"),s),p[s]={date:e.unix(),percent:formatNumber(c[s]||0),down:{times:0,duration:0}}}));const v={times:0,duration:0};return null==(s=null==e?void 0:e.logs)||s.forEach((e=>{if(1===(null==e?void 0:e.type)||99===(null==e?void 0:e.type)){const s=u.unix(null==e?void 0:e.datetime).format("YYYYMMDD"),i=g.get(s);void 0!==i&&p[i]&&(p[i].down.times+=1,p[i].down.duration+=e.duration),v.times+=1,v.duration+=e.duration}})),{id:e.id,name:(null==e?void 0:e.friendly_name)||"未命名站点",url:r?null==e?void 0:e.url:void 0,status:null!=(n=null==e?void 0:e.status)?n:8,type:null!=(o=null==e?void 0:e.type)?o:1,interval:null!=(a=null==e?void 0:e.interval)?a:0,percent:f,days:null==p?void 0:p.reverse(),down:v}}));return{status:a.reduce(((e,s)=>(2===s.status?e.ok++:8===s.status||9===s.status?e.error++:0!==s.status&&1!==s.status||e.unknown++,e)),{count:a.length,ok:0,error:0,unknown:0}),data:a,timestamp:Date.now()}})(await $fetch(a+"getMonitors",{method:"POST",body:A}),z);return((e,s,i)=>{_.set(e,s,{ttl:i})})(g,T,6e4),{code:200,message:"success",source:"api",data:T}}catch(s){return o(e,500),{code:500,message:s instanceof Error?s.message:"Unknown error",source:"api",data:void 0}}var i}));export{z as default};
//# sourceMappingURL=getMonitors.post.mjs.map
